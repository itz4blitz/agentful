# Project Structure

Agentful requires a specific project structure to function correctly. Understanding the required and optional files helps you organize your project effectively.

## Required Directory Structure

```
.your-project/
├── .claude/                    # REQUIRED - Agentful configuration
│   ├── settings.json           # REQUIRED - Global settings
│   ├── agents/                 # REQUIRED - Agent definitions
│   │   ├── orchestrator.md
│   │   ├── architect.md
│   │   ├── backend.md
│   │   ├── frontend.md
│   │   ├── tester.md
│   │   ├── reviewer.md
│   │   └── fixer.md
│   ├── commands/               # REQUIRED - Slash commands
│   │   ├── agentful-start.md
│   │   ├── agentful-status.md
│   │   ├── agentful-decide.md
│   │   └── agentful-validate.md
│   └── skills/                 # REQUIRED - Reusable modules
│       ├── validation/
│       │   └── SKILL.md
│       └── product-tracking/
│           └── SKILL.md
│
├── .agentful/                  # REQUIRED - Runtime state (gitignored)
│   ├── state.json              # Auto-created on init
│   ├── completion.json         # Auto-created on init
│   ├── decisions.json          # Auto-created on init
│   ├── architecture.json       # Auto-created by architect
│   └── last-validation.json    # Auto-created by reviewer
│
├── PRODUCT.md                  # REQUIRED - Your product spec
└── CLAUDE.md                   # OPTIONAL - Project-specific guide
```

## File Requirements

### Absolutely Required

| File | Purpose | Created By |
|------|---------|------------|
| `.claude/settings.json` | Hooks, permissions | `npx agentful init` |
| `.claude/agents/*.md` | Agent definitions | `npx agentful init` |
| `.claude/commands/*.md` | Slash commands | `npx agentful init` |
| `.claude/skills/*/SKILL.md` | Skill modules | `npx agentful init` |
| `PRODUCT.md` | Product spec | You (edit template) |
| `.agentful/state.json` | Work state | CLI on init |

### Recommended

| File | Purpose | When to Create |
|------|---------|----------------|
| `CLAUDE.md` | Project-specific instructions | For custom workflows |
| `.env` | Environment variables | When using external services |
| `.gitignore` | Git exclusions | Always (auto-updated by init) |

### Auto-Generated (Don't Edit)

| File | Purpose | Generated By |
|------|---------|--------------|
| `.agentful/completion.json` | Progress tracking | Orchestrator |
| `.agentful/decisions.json` | User decisions | Orchestrator |
| `.agentful/architecture.json` | Tech stack info | Architect |
| `.agentful/last-validation.json` | Validation results | Reviewer |

## Initialization Process

### Full Initialization (with templates)

```bash
npx agentful init
```

Creates:
- All required `.claude/` configuration
- All `.agentful/` state files
- `PRODUCT.md` template
- `CLAUDE.md` template
- Updates `.gitignore`

### Bare Initialization (existing project)

```bash
npx agentful init --bare
```

Creates:
- All required `.claude/` configuration
- All `.agentful/` state files
- Updates `.gitignore`

Skips:
- `PRODUCT.md` (if exists)
- `CLAUDE.md` (if exists)

## .claude/settings.json

This is the core configuration file that controls hooks and permissions.

### Structure

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "npx tsc --noEmit 2>&1 | head -5 || true"
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "if [ -f .agentful/state.json ]; then jq -r '.current_phase // \"idle\"' .agentful/state.json 2>/dev/null || echo 'idle'; else echo 'idle'; fi"
          }
        ]
      }
    ]
  },
  "permissions": {
    "allow": [
      "Bash(npm:*)",
      "Bash(npx:*)",
      "Bash(node:*)",
      "Bash(git:*)",
      "Bash(cat:*)",
      "Bash(echo:*)",
      "Bash(jq:*)"
    ],
    "deny": [
      "Bash(rm -rf /)",
      "Bash(rm -rf ~/.*)",
      "Bash(rm -rf /.*)",
      "Bash(dd:*)",
      "Bash(mkfs:*)"
    ]
  }
}
```

### Hooks Reference

| Hook | Trigger | Use Case |
|------|---------|----------|
| `PostToolUse` | After any tool use | Run type checks, linting |
| `PreToolUse` | Before tool execution | Validate state, check locks |
| `UserPromptSubmit` | When user submits message | Display context, check decisions |

### Permission Patterns

Allow patterns support wildcards:

```json
{
  "permissions": {
    "allow": [
      "Bash(npm:*)",           // All npm commands
      "Bash(npx:*)",           // All npx commands
      "Bash(git:*)",           // All git commands
      "Bash(node:*)",          // All node scripts
      "Bash(cat:*.md)",        // cat markdown files only
      "Bash(jq:.agentful/*)"   // jq on agentful files only
    ],
    "deny": [
      "Bash(rm -rf /)",        // Never allow rm -rf /
      "Bash(rm -rf ~/.*)",     // Never allow rm home
      "Bash(dd:*)",            // Never allow dd command
      "Bash(mkfs:*)"           // Never allow filesystem creation
    ]
  }
}
```

## PRODUCT.md Structure

The product specification file is the most important configuration file.

### Required Sections

```markdown
# Product Specification

## Overview
[2-3 sentence description of what you're building]

## Goals
- [ ] Primary goal 1
- [ ] Primary goal 2
- [ ] Primary goal 3

## Tech Stack

### Frontend
- **Framework**: [Next.js / React / Vue / Svelte]
- **Language**: [TypeScript / JavaScript]
- **Styling**: [Tailwind / CSS Modules / styled-components]

### Backend
- **Runtime**: [Node.js / Bun / Deno]
- **Framework**: [Express / Fastify / NestJS / Next.js API]
- **Language**: [TypeScript / JavaScript]

### Database
- **Database**: [PostgreSQL / MySQL / MongoDB / SQLite]
- **ORM**: [Prisma / Drizzle / TypeORM / Mongoose]

### Authentication
- **Method**: [JWT / Sessions / NextAuth / Clerk]

### Testing
- **Unit**: [Vitest / Jest]
- **E2E**: [Playwright / Cypress]

## Features

### 1. [Feature Name] - CRITICAL
**Description**: [What this feature does]

**Acceptance Criteria**:
- [ ] [Specific requirement 1]
- [ ] [Specific requirement 2]
- [ ] [Specific requirement 3]

**User Stories**:
- As a [user type], I want [feature] so that [benefit]

## Success Criteria

The product is complete when:
1. [All critical features implemented and tested]
2. [All tests passing with 80%+ coverage]
3. [No type errors (adapts to stack)]
4. [No security vulnerabilities]
5. [Deployed to production]
```

### Minimal PRODUCT.md

```markdown
# Product Specification

## Overview
A simple TODO list application.

## Tech Stack
- Next.js 14
- TypeScript
- Tailwind CSS
- Prisma + SQLite

## Features

### 1. Create TODO - CRITICAL
- User can add a task
- Task has title and description

### 2. List TODOs - CRITICAL
- Display all tasks
- Show completion status

## Success Criteria
1. All features working
2. Tests passing
3. No type errors (adapts to stack)
```

## CLAUDE.md Structure

Optional project-specific instructions file.

### When to Use CLAUDE.md

- Custom architectural patterns
- Company coding standards
- Special validation rules
- Team-specific workflows

### Example CLAUDE.md

```markdown
# Agentful Product Development

This project uses Agentful with custom settings.

## Project-Specific Rules

1. All API routes must use Zod validation
2. All components must use TypeScript strict mode
3. Database queries must use prepared statements
4. All tests must use Vitest

## Custom Workflows

### Before committing
- Run `/agentful-validate`
- Fix any issues
- Update completion status

### Code review process
- Use @reviewer after every feature
- Fix issues with @fixer
- Re-validate before moving on

## Special Instructions

- Use our company's component library
- Follow our API design guidelines
- All logs must go to our logging service
- Use our custom error handler
```

## .agentful/ State Files

These files are auto-generated and should not be manually edited.

### state.json

```json
{
  "version": "1.0.0",
  "current_task": "implementing-authentication",
  "current_phase": "implementation",
  "iterations": 5,
  "last_updated": "2026-01-18T00:00:00Z",
  "blocked_on": []
}
```

### completion.json

```json
{
  "features": {
    "authentication": {
      "status": "complete",
      "score": 100,
      "started_at": "2026-01-18T00:00:00Z",
      "completed_at": "2026-01-18T01:00:00Z"
    },
    "user-profile": {
      "status": "in_progress",
      "score": 45,
      "started_at": "2026-01-18T01:00:00Z"
    }
  },
  "gates": {
    "tests_passing": true,
    "no_type_errors": true,
    "no_dead_code": false,
    "coverage_80": false,
    "security_clean": true
  },
  "overall": 48,
  "last_updated": "2026-01-18T01:30:00Z"
}
```

### decisions.json

```json
{
  "pending": [
    {
      "id": "decision-001",
      "question": "Should auth use JWT or session cookies?",
      "options": [
        "JWT (stateless, scalable)",
        "Sessions (simpler, built-in)"
      ],
      "context": "Building authentication system",
      "blocking": ["auth-feature"],
      "timestamp": "2026-01-18T00:00:00Z"
    }
  ],
  "resolved": [
    {
      "id": "decision-000",
      "question": "Database provider?",
      "answer": "PostgreSQL",
      "timestamp": "2026-01-17T23:00:00Z"
    }
  ]
}
```

## Git Configuration

### .gitignore

Agentful automatically adds to `.gitignore`:

```gitignore
# Agentful runtime state
.agentful/
```

### Recommended Full .gitignore

```gitignore
# Dependencies
node_modules/

# Agentful runtime state
.agentful/

# Environment variables
.env
.env.local
.env.*.local

# Build output
.next/
out/
dist/
build/

# IDE
.vscode/
.idea/

# OS
.DS_Store
Thumbs.db

# Testing
coverage/

# Logs
*.log
npm-debug.log*
```

## Next Steps

- [Agent Configuration](./agent-configuration) - Customize agents for your tech stack
- [Workflow Configuration](./workflow-configuration) - Create custom commands and workflows
