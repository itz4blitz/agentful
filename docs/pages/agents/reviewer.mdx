# Reviewer Agent

Validates code quality through 9 comprehensive checks. Detects issues but doesn't fix them.

**Model:** Sonnet

**Tools:** Read, Glob, Grep, Bash, Write, Edit

**Key Rule:** Reviewer DETECTS issues. Fixer FIXES them.

## The 9 Checks

### 1. TypeScript Check

```bash
npx tsc --noEmit
```

Fails if any type errors found.

### 2. Lint Check

```bash
npm run lint
```

Fails if any lint errors (warnings are OK).

### 3. Dead Code Detection

```bash
npx knip --reporter json
# or
npx ts-prune
```

Fails if unused exports, imports, files, or dependencies.

### 4. Test Check

```bash
npm test
```

Fails if any tests fail.

### 5. Coverage Check

```bash
npm test -- --coverage
```

Fails if coverage < 80%.

### 6. Security Check

```bash
npm audit --production
grep -r "console\.log" src/
grep -rE "api[_-]?key.*[:=].*['\"]" src/
```

Fails if high/critical vulnerabilities, hardcoded secrets, or debug logs.

### 7. Documentation Check

Check for:
- Missing JSDoc on public functions
- README.md exists
- API documentation

### 8. Manual Code Review

Check for:
- Unhandled promise rejections
- Missing error boundaries
- Hardcoded secrets
- TODO/FIXME comments

### 9. Quality Gates

All must pass:
- `tests_passing`
- `no_type_errors`
- `no_dead_code`
- `coverage_80`

## Output Format

Saves to `.agentful/last-validation.json`:

### Failed Review

```json
{
  "passed": false,
  "timestamp": "2026-01-20T00:00:00Z",
  "checks": {
    "typescript": { "passed": true },
    "lint": { "passed": true },
    "deadCode": {
      "passed": false,
      "issues": [
        "Unused export: formatDate in src/utils/date.ts",
        "Unused file: src/components/OldWidget.tsx"
      ]
    },
    "tests": { "passed": true },
    "coverage": {
      "passed": false,
      "actual": 72,
      "required": 80
    },
    "security": {
      "passed": false,
      "issues": [
        "console.log in src/auth/login.ts:45",
        "Hardcoded secret in src/config/api.ts:12"
      ]
    },
    "documentation": { "passed": true },
    "manualReview": { "passed": true }
  },
  "mustFix": [
    "Remove unused export formatDate",
    "Delete unused file OldWidget.tsx",
    "Add tests to reach 80% coverage",
    "Remove console.log from login.ts:45",
    "Fix hardcoded secret in api.ts:12"
  ]
}
```

### Passed Review

```json
{
  "passed": true,
  "timestamp": "2026-01-20T00:00:00Z",
  "checks": {
    "typescript": { "passed": true },
    "lint": { "passed": true },
    "deadCode": { "passed": true },
    "tests": { "passed": true },
    "coverage": { "passed": true },
    "security": { "passed": true },
    "documentation": { "passed": true },
    "manualReview": { "passed": true }
  },
  "summary": "All validation checks passed. Code is production-ready."
}
```

## Workflow

```
1. Run all 9 checks sequentially
2. Collect all failures
3. Categorize (mustFix vs canIgnore)
4. Save to .agentful/last-validation.json
5. If failed → Orchestrator delegates to Fixer
6. If passed → Update completion state
```

## Common Issues

### Type Errors

```typescript
// Bad
function process(data: any) { ... }

// Good
function process(data: UserData[]): ProcessedData[] { ... }
```

### Dead Code

```typescript
// Bad
export function unused() { ... }  // Never imported

// Good
// Delete it completely
```

### Low Coverage

```bash
# Add tests until coverage >= 80%
npm test -- --coverage
```

### Security Issues

```typescript
// Bad
const API_KEY = "sk-1234567890";

// Good
const API_KEY = process.env.API_KEY;
```

## Rules

**ALWAYS:**
- Run all 9 checks
- Be specific about file locations
- Save report to .agentful/last-validation.json
- Never fix issues yourself

**NEVER:**
- Skip checks for "small changes"
- Fix issues (delegate to Fixer)
- Ignore coverage thresholds

## After Review

```json
{
  "overall_passed": false,
  "critical_issues": 3,
  "recommendations": [
    "Fix all mustFix items before deployment"
  ]
}
```

## See Also

- [Fixer Agent](/agents/fixer) - Fixes detected issues
- [Tester Agent](/agents/tester) - Writes tests
- [Orchestrator Agent](/agents/orchestrator) - Coordinates review
