# Self-Hosted Agent Server

agentful isn't just a toolkit - it's a **self-hosted AI agent orchestration server** that runs on YOUR infrastructure.

## What is `agentful serve`?

The `agentful serve` command transforms your server into an **autonomous agent execution platform**:

```bash
# Deploy on your infrastructure
agentful serve --auth=tailscale --port=3000

# Now accessible remotely
curl -X POST https://your-server:3000/agent/orchestrator \
  -H "Content-Type: application/json" \
  -d '{"task": "Build authentication system"}'
```

**Key Features**:
- ğŸ”’ **Self-hosted**: Your code never leaves your infrastructure
- ğŸŒ **Remote execution**: Run agents from anywhere (CI/CD, mobile, web)
- ğŸ” **Multiple auth modes**: Tailscale, HMAC, SSH tunnels
- ğŸš€ **Multi-platform CI/CD**: GitHub Actions, GitLab, Jenkins, CircleCI
- ğŸ’° **Cost-effective**: Deploy on Oracle Cloud free tier ($0/month)

---

## Why Self-Host?

### Data Privacy & Control

**Your Code Stays on Your Servers**:
```bash
# Traditional Claude Code
Local Machine â†’ Anthropic API â†’ Response
(Code sent to Anthropic)

# agentful serve
CI/CD â†’ Your Server â†’ LLM API â†’ Your Server â†’ Response
(Code never leaves your infrastructure)
```

**Benefits**:
- Proprietary code never transmitted
- Compliance (SOC 2, HIPAA, GDPR)
- Air-gapped deployments possible
- Full audit trail

### Cost Optimization

**Oracle Cloud Free Tier** (Forever Free):
- 4 ARM cores (Ampere A1)
- 24GB RAM
- 200GB storage
- **$0/month**

vs **Managed Services**:
- Replit Agents: $25-100/month
- GitHub Copilot Enterprise: $39/user/month
- Cursor Pro: $20/month

**Break-even**: ~5-10 users on self-hosted

### Multi-Platform CI/CD

**Not Locked to GitHub Actions**:

```yaml
# GitHub Actions
- uses: your-server:3000/agent/architect

# GitLab CI
script:
  - curl https://your-server:3000/agent/backend

# Jenkins
sh 'curl https://your-server:3000/agent/tester'

# CircleCI, Bitbucket, Travis, etc.
# Standard HTTP API works everywhere
```

### Remote Development

**Mobile-First Future**:
```bash
# Future: Voice interface on mobile
Phone â†’ "Build me a todo app"
      â†’ agentful server
      â†’ Agents build entire app
      â†’ Return working app

# Voice â†’ Autonomous Agents â†’ Deployed App
```

---

## Architecture

### Server Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         agentful Server Architecture        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     HTTP/REST API (Port 3000)         â”‚ â”‚
â”‚  â”‚  POST /agent/{name}                   â”‚ â”‚
â”‚  â”‚  GET /status                          â”‚ â”‚
â”‚  â”‚  POST /pipeline/execute               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â†“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Authentication Layer              â”‚ â”‚
â”‚  â”‚  â€¢ Tailscale (recommended)            â”‚ â”‚
â”‚  â”‚  â€¢ HMAC signatures                    â”‚ â”‚
â”‚  â”‚  â€¢ SSH tunnel                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â†“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Agent Orchestrator                â”‚ â”‚
â”‚  â”‚  Routes to specialized agents         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â†“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     8 Specialized Agents              â”‚ â”‚
â”‚  â”‚  orchestrator â”‚ architect â”‚ backend   â”‚ â”‚
â”‚  â”‚  frontend â”‚ tester â”‚ reviewer â”‚ fixer â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â†“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     LLM Provider (configurable)       â”‚ â”‚
â”‚  â”‚  Claude â”‚ GLM â”‚ DeepSeek â”‚ Gemini    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â†“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Quality Gates & Validation        â”‚ â”‚
â”‚  â”‚  Types â”‚ Lint â”‚ Tests â”‚ Coverage      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request Flow

```
1. Client Request
   â†“
2. Authentication (Tailscale/HMAC/SSH)
   â†“
3. Route to Agent
   â†“
4. Agent Execution (with LLM)
   â†“
5. Quality Gates
   â†“
6. Return Results
```

---

## Deployment Options

### Oracle Cloud (Recommended - Free Forever)

**Why Oracle Cloud Free Tier?**:
- **Always free**: No time limit, no credit card charges
- **Powerful**: 4 ARM cores, 24GB RAM
- **Global**: Data centers worldwide
- **Stable**: Enterprise-grade infrastructure

**Setup**:
```bash
# 1. Create Oracle Cloud account
# 2. Launch Always Free ARM instance (Ubuntu)
# 3. Install Node.js 22+
# 4. Deploy agentful

ssh ubuntu@your-oracle-instance
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt-get install -y nodejs
npm install -g @itz4blitz/agentful
agentful serve --auth=tailscale --port=3000
```

[Full Oracle Cloud Guide â†’](#TODO)

### AWS / GCP / Azure

**For existing infrastructure**:

```bash
# AWS EC2 (t3.medium recommended)
aws ec2 run-instances \
  --image-id ami-xxx \
  --instance-type t3.medium \
  --user-data "#!/bin/bash
    npm install -g @itz4blitz/agentful
    agentful serve --auth=hmac"

# GCP Compute Engine
gcloud compute instances create agentful-server \
  --machine-type=e2-medium \
  --startup-script="npm install -g @itz4blitz/agentful && agentful serve"

# Azure VM
az vm create \
  --resource-group myResourceGroup \
  --name agentful-server \
  --custom-data cloud-init.txt
```

[Full Cloud Provider Guide â†’](#TODO)

### Docker / Kubernetes

**Containerized deployment**:

```dockerfile
FROM node:22-alpine
RUN npm install -g @itz4blitz/agentful
EXPOSE 3000
CMD ["agentful", "serve", "--port=3000"]
```

```yaml
# kubernetes deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: agentful-server
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: agentful
        image: agentful:latest
        ports:
        - containerPort: 3000
```

[Full Docker/K8s Guide â†’](#TODO)

### On-Premises / Homelab

**Self-hosted on your hardware**:

```bash
# Ubuntu server
sudo apt update
sudo apt install nodejs npm
npm install -g @itz4blitz/agentful

# Start with systemd
sudo systemctl enable agentful
sudo systemctl start agentful
```

[Full On-Prem Guide â†’](#TODO)

---

## Authentication Modes

### Tailscale (Recommended)

**Zero-config VPN with WireGuard**:

```bash
# Install Tailscale on server
curl -fsSL https://tailscale.com/install.sh | sh
sudo tailscale up

# Start agentful with Tailscale auth
agentful serve --auth=tailscale --port=3000

# Access from any Tailscale device
curl http://your-server-name:3000/agent/orchestrator
```

**Benefits**:
- âœ… Encrypted by default (WireGuard)
- âœ… No exposed ports
- âœ… Automatic DNS
- âœ… ACLs for access control
- âœ… Works across NAT/firewalls

[Tailscale Setup Guide â†’](#TODO)

### HMAC Signatures

**Public endpoints with request signing**:

```bash
# Generate secret
export AGENTFUL_SECRET=$(openssl rand -base64 32)

# Start server
agentful serve --auth=hmac --secret=$AGENTFUL_SECRET

# Client signs requests
SIGNATURE=$(echo -n "$REQUEST_BODY" | openssl dgst -sha256 -hmac "$SECRET" -binary | base64)

curl -X POST https://your-server:3000/agent/orchestrator \
  -H "X-Agentful-Signature: $SIGNATURE" \
  -H "X-Agentful-Timestamp: $(date +%s)" \
  -d "$REQUEST_BODY"
```

**Features**:
- âœ… Replay attack protection (timestamp validation)
- âœ… Request integrity (tamper-proof)
- âœ… Works with public endpoints
- âœ… No VPN required

[HMAC Setup Guide â†’](#TODO)

### SSH Tunnel

**Localhost-only with SSH port forwarding**:

```bash
# Server (no auth needed, listens on localhost only)
agentful serve --auth=none --host=127.0.0.1 --port=3000

# Client (create SSH tunnel)
ssh -L 3000:localhost:3000 your-server

# Access via localhost
curl http://localhost:3000/agent/orchestrator
```

**Best For**:
- Development environments
- Temporary access
- Simple setups

[SSH Tunnel Guide â†’](#TODO)

---

## API Reference

### POST /agent/\{agent_name\}

Execute a specific agent:

```bash
curl -X POST https://your-server:3000/agent/architect \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Design authentication system",
    "context": {
      "project": "/path/to/project",
      "stack": ["node", "react", "postgres"]
    }
  }'
```

**Available Agents**:
- `orchestrator` - Overall task coordination
- `architect` - System design
- `backend` - Server-side implementation
- `frontend` - Client-side implementation
- `tester` - Test generation and execution
- `reviewer` - Code review
- `fixer` - Bug fixing
- `product-analyzer` - Product spec analysis

### POST /pipeline/execute

Execute multi-agent pipeline:

```bash
curl -X POST https://your-server:3000/pipeline/execute \
  -H "Content-Type: application/json" \
  -d '{
    "pipeline": [
      {"agent": "architect", "task": "Design system"},
      {"agent": "backend", "task": "Implement API"},
      {"agent": "frontend", "task": "Build UI"},
      {"agent": "tester", "task": "Generate tests"},
      {"agent": "reviewer", "task": "Review code"}
    ],
    "context": {
      "project_root": "/workspace"
    }
  }'
```

### GET /status

Health check:

```bash
curl https://your-server:3000/status

# Response:
{
  "status": "healthy",
  "uptime": 86400,
  "agents": 8,
  "llm_provider": "glm-4.7",
  "version": "1.1.0"
}
```

[Full API Documentation â†’](#TODO)

---

## CI/CD Integration

### GitHub Actions

```yaml
name: agentful CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Run agentful architect
        run: |
          curl -X POST ${{ secrets.AGENTFUL_SERVER }}/agent/architect \
            -H "X-Agentful-Signature: ${{ secrets.AGENTFUL_SIGNATURE }}" \
            -d '{"prompt": "Review architecture"}'

      - name: Run agentful tester
        run: |
          curl -X POST ${{ secrets.AGENTFUL_SERVER }}/agent/tester \
            -d '{"prompt": "Generate integration tests"}'
```

### GitLab CI

```yaml
stages:
  - analyze
  - test

architect:
  stage: analyze
  script:
    - curl -X POST $AGENTFUL_SERVER/agent/architect
          -d '{"prompt": "Analyze changes"}'

tester:
  stage: test
  script:
    - curl -X POST $AGENTFUL_SERVER/agent/tester
          -d '{"prompt": "Run tests"}'
```

### Jenkins

```groovy
pipeline {
  agent any
  stages {
    stage('agentful Review') {
      steps {
        sh '''
          curl -X POST ${AGENTFUL_SERVER}/agent/reviewer \
            -d '{"prompt": "Review PR changes"}'
        '''
      }
    }
  }
}
```

[Full CI/CD Integration Guide â†’](/ci-integration)

---

## Monitoring & Observability

### Health Checks

```bash
# Simple health check
curl https://your-server:3000/status

# Prometheus metrics (future)
curl https://your-server:3000/metrics
```

### Logging

```bash
# View server logs
agentful serve --log-level=debug

# Structured logging
{
  "timestamp": "2025-01-22T10:30:00Z",
  "level": "info",
  "agent": "orchestrator",
  "task": "build_auth_system",
  "duration_ms": 45000,
  "llm_provider": "glm-4.7",
  "cost": "$0.23"
}
```

### Metrics

**Track important metrics**:
- Request latency
- Agent success rate
- LLM provider costs
- Error rates
- Resource usage

[Full Monitoring Guide â†’](#TODO)

---

## Scaling

### Horizontal Scaling

```yaml
# Kubernetes HPA
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: agentful-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: agentful-server
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
```

### Load Balancing

```bash
# nginx load balancer
upstream agentful_servers {
  server agentful-1:3000;
  server agentful-2:3000;
  server agentful-3:3000;
}

server {
  listen 80;
  location / {
    proxy_pass http://agentful_servers;
  }
}
```

[Full Scaling Guide â†’](#TODO)

---

## Use Cases

### Autonomous App Builder (Future Vision)

```
Mobile App (Voice Interface)
         â†“
    "Build me a todo app"
         â†“
    agentful Server
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Architect: Design    â”‚
â”‚ 2. Backend: API         â”‚
â”‚ 3. Frontend: UI         â”‚
â”‚ 4. Tester: Tests        â”‚
â”‚ 5. Deploy: Production   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    Working App Deployed
```

### CI/CD Agent Execution

```
Git Push â†’ GitHub Actions â†’ agentful Server â†’ Agents Execute â†’ Tests Pass â†’ Deploy
```

### Remote Development Server

```
Developer â†’ Web IDE â†’ agentful API â†’ Agents Code â†’ Return Results
```

### Multi-Tenant Agent Platform

```
Customer A â†’ API Key â†’ agentful â†’ Isolated Environment
Customer B â†’ API Key â†’ agentful â†’ Isolated Environment
```

---

## Security Best Practices

### Network Security

```bash
# 1. Use Tailscale (recommended)
agentful serve --auth=tailscale

# 2. Or firewall + HMAC
sudo ufw allow from 10.0.0.0/8 to any port 3000
agentful serve --auth=hmac

# 3. Never expose with --auth=none publicly
# BAD: agentful serve --auth=none --host=0.0.0.0
# GOOD: agentful serve --auth=tailscale
```

### Secrets Management

```bash
# Use environment variables
export ANTHROPIC_API_KEY=$(cat /secrets/claude-key)
export AGENTFUL_SECRET=$(cat /secrets/hmac-secret)

# Or secret managers
# AWS Secrets Manager
# HashiCorp Vault
# Kubernetes Secrets
```

### Rate Limiting

```bash
# Future feature: built-in rate limiting
agentful serve --rate-limit=100/minute --rate-limit-per-ip=10/minute
```

[Full Security Guide â†’](#TODO)

---

## Cost Analysis

### Oracle Cloud Free Tier

```
Infrastructure: $0/month
LLM API (GLM-4.7): ~$60/month (100M tokens)
Total: $60/month

vs

Replit Agents: $100/month (hosted)
GitHub Copilot Enterprise: $390/month (10 users)

Savings: $330/month (85%)
```

### Scaling Economics

```
10 users Ã— 50M tokens/month = 500M tokens

Self-hosted (GLM-4.7):
Infrastructure: $0 (Oracle free tier)
LLM: 500M Ã— $0.60/M = $300/month
Total: $300/month ($30/user)

Managed Service:
10 users Ã— $40/user = $400/month

Break-even: ~8 users
```

[Full Cost Analysis â†’](#TODO)

---

## Next Steps

- **[Deploy to Oracle Cloud](#TODO)** - Free forever hosting
- **[Configure Tailscale](#TODO)** - Secure remote access
- **[Integrate with CI/CD](/ci-integration)** - Automate workflows
- **[Set up monitoring](#TODO)** - Track performance
- **[Scale horizontally](#TODO)** - Handle more load
