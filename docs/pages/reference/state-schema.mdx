# State Schema Reference

This document describes the structure of `.agentful/state.json`, the core state file used by agentful.

## Overview

The `state.json` file tracks the current execution state of agentful, including:
- Current task and phase
- Iteration count
- Blocking decisions

## Schema

### Complete Example

```json
{
  "version": "1.0",
  "current_task": "authentication/login",
  "current_phase": "implementing",
  "iterations": 5,
  "last_updated": "2026-01-20T10:30:00.000Z",
  "blocked_on": []
}
```

## Field Reference

#### `version`
- **Type**: `string`
- **Required**: Yes
- **Description**: Schema version for backward compatibility
- **Example**: `"1.0"`

#### `current_task`
- **Type**: `string | null`
- **Required**: Yes
- **Description**: ID of the currently active task/feature
- **Example**: `"authentication/login"` or `null`

#### `current_phase`
- **Type**: `string`
- **Required**: Yes
- **Description**: Current phase of development
- **Values**: `"idle"`, `"analyzing"`, `"implementing"`, `"testing"`, `"reviewing"`, `"fixing"`, `"validating"`
- **Example**: `"implementing"`

#### `iterations`
- **Type**: `number`
- **Required**: Yes
- **Description**: Number of development loop iterations completed
- **Example**: `5`

#### `last_updated`
- **Type**: `string` (ISO 8601 timestamp)
- **Required**: Yes
- **Description**: When the state was last modified
- **Example**: `"2026-01-20T10:30:00.000Z"`

#### `blocked_on`
- **Type**: `array<string>`
- **Required**: Yes
- **Description**: List of decision IDs blocking progress
- **Example**: `["decision-001", "decision-002"]` or `[]`

## Usage

### Reading State

```javascript
const state = JSON.parse(Read(".agentful/state.json"));
const currentTask = state.current_task;
const phase = state.current_phase;
const isBlocked = state.blocked_on.length > 0;
```

### Updating State

```javascript
// Read current state
const state = JSON.parse(Read(".agentful/state.json"));

// Update fields
state.current_task = "authentication/login";
state.current_phase = "implementing";
state.iterations += 1;
state.last_updated = new Date().toISOString();

// Write back
Write(".agentful/state.json", JSON.stringify(state, null, 2));
```

### Checking for Blockers

```javascript
const state = JSON.parse(Read(".agentful/state.json"));
if (state.blocked_on.length > 0) {
  console.log(`Blocked on decisions: ${state.blocked_on.join(", ")}`);
  // User should run /agentful-decide to resolve
}
```

## Best Practices

1. **Always validate state exists** before reading
2. **Update `last_updated`** when modifying state
3. **Use ISO 8601 timestamps** for all time fields
4. **Increment `iterations`** when completing a development loop
5. **Clear `blocked_on`** when decisions are resolved
6. **Set `current_task` to null** when no active task

## Related Files

- `.agentful/completion.json` - Feature completion tracking
- `.agentful/decisions.json` - Pending user decisions
- `.agentful/architecture.json` - Detected tech stack

## See Also

- [/agentful-start command](/commands/agentful-start)
- [/agentful-status command](/commands/agentful-status)
- [Orchestrator Agent](/agents/orchestrator)
