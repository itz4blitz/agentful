---
title: Smart Orchestration
description: How agentful classifies work and routes to appropriate workflows automatically
---

# agentful Smart Orchestration

## Overview

agentful has been enhanced with **smart work classification** and **self-improvement capabilities**. Users can now simply talk to Claude, and agentful will automatically:

1. **Classify the work type** (feature, bugfix, enhancement, refactor, meta-work, maintenance)
2. **Route to the appropriate workflow** (autonomous loop vs one-off task)
3. **Detect context** (working on agentful itself vs user project)
4. **Self-improve** (agents can recognize limitations and improve themselves)

## Key Changes

### 1. Orchestrator Enhancement (`.claude/agents/orchestrator.md`)

**Added: Work Classification System**

The orchestrator now classifies user requests into 8 work types:

| Work Type | Trigger | Workflow | Loop? |
|-----------|---------|----------|-------|
| **FEATURE_DEVELOPMENT** | "Build/add/create [feature]" | Read product spec → Build features | ✅ Yes |
| **BUGFIX** | "Fix [bug/error]" | Quick fix → Test → Validate | ❌ No |
| **ENHANCEMENT** | "Add [X] to [Y]" / "enhance" | Enhance → Test → Validate | ❌ No |
| **REFACTOR** | "Refactor/improve [code]" | Refactor → Test → Validate | ❌ No |
| **META_WORK** | "Add agent/command" (agentful only) | Meta-development | ❌ No |
| **MAINTENANCE** | "Update deps/security" | Maintenance workflow | ❌ No |
| **IMPROVE_AGENTS** | "Improve agent" (agentful only) | Self-improvement | ❌ No |
| **UPDATE_SKILLS** | "Update skill" (agentful only) | Skill update | ❌ No |

**Added: Context Detection**

The orchestrator now detects if it's working in the agentful repository itself:

```bash
if exists(".claude/agents/orchestrator.md") AND
   exists("bin/cli.js") AND
   package.json.name === "agentful":
    context = "agentful_framework"
    capabilities = ["framework_development", "agent_modification", "skill_updates"]
else:
    context = "user_project"
    capabilities = ["feature_development", "bugfixes", "enhancements"]
```

This enables **dogfooding** - agentful can improve itself!

### 2. Agent Self-Improvement System

**New Files:**
- `.agentful/agent-improvements.json` - Tracks agent improvement suggestions
- `.agentful/skill-improvements.json` - Tracks skill improvement suggestions
- `.agentful/last-known-framework-version.json` - Tracks framework version and checksums

**How It Works:**

1. Agent encounters a limitation or pattern it doesn't handle well
2. Agent logs improvement suggestion to `.agentful/agent-improvements.json`
3. On next orchestrator loop, if HIGH priority improvements exist:
   - Classify as META_WORK → IMPROVE_AGENT
   - Delegate improvement workflow
   - Update agent file
   - Test improved agent
4. Mark improvement as complete

**Example:**

```json
{
  "pending": [
    {
      "id": "improvement-001",
      "agent": "backend",
      "issue": "Doesn't handle database migrations well",
      "suggestion": "Add migration workflow with schema drift detection",
      "priority": "HIGH"
    }
  ]
}
```

### 3. Framework Update Detection

agentful now detects when it's been updated (via `npm update` or pulling latest):

**Workflow:**

1. Calculate checksums of all agents/skills/commands
2. Compare with stored checksums
3. If checksums differ:
   - **In agentful repo**: User made changes intentionally
   - **In user project**: agentful was updated, offer to regenerate specialized agents

### 4. Enhanced /agentful-start Command

**Before:**
```
/agentful-start → Always runs autonomous feature development loop
```

**After:**
```
/agentful-start "Fix the login bug" → BUGFIX workflow (one-off)
/agentful-start "Add authentication" → FEATURE_DEVELOPMENT (autonomous loop)
/agentful-start "Refactor user service" → REFACTOR (one-off)
/agentful-start → Continue autonomous development loop (default)
```

**Also checks for:**
- Framework updates
- Agent improvement suggestions
- Skill improvement suggestions

## User Experience

### Before (Rigid)

```bash
# User wants to fix a bug
User: /agentful-start

Orchestrator: Reading product specs... Building features...
User: No, I just want to fix this one bug
Orchestrator: Sorry, I only do autonomous feature development
```

### After (Smart)

```bash
# User wants to fix a bug
User: Fix the login bug with special characters

Orchestrator:
- Classified as: BUGFIX
- Delegating to @frontend agent
- [Fix] Updated regex to properly escape special chars
- [Test] Added regression test
- [Validate] All tests passing
- Complete: Bug fixed in 5 minutes

# User wants to add a feature
User: Add authentication to my app

Orchestrator:
- Classified as: FEATURE_DEVELOPMENT
- Reading PRODUCT.md...
- Found: Authentication feature (CRITICAL priority)
- Delegating to @backend for JWT implementation
- Delegating to @frontend for login form
- Updated: completion.json auth.score = 100
- Continuing to next feature...

# Maintainer (you) working on agentful itself
User: Add a deployment command to agentful

Orchestrator:
- Context: Working in agentful repository
- Classified as: META_WORK → ADD_COMMAND
- [Create] .claude/commands/agentful-deploy.md
- [Update] bin/cli.js to register command
- [Test] Command executes correctly
- Complete: Deployment command added
```

## Technical Details

### New State Files

**`.agentful/agent-improvements.json`**
```json
{
  "pending": [
    {
      "id": "improvement-001",
      "agent": "backend",
      "issue": "Doesn't handle database migrations well",
      "suggestion": "Add migration workflow",
      "priority": "HIGH",
      "timestamp": "2026-01-18T00:00:00Z",
      "suggested_by": "backend" // or another agent
    }
  ],
  "completed": []
}
```

**`.agentful/last-known-framework-version.json`**
```json
{
  "version": "1.0.0",
  "last_checked": "2026-01-18T00:00:00Z",
  "agent_checksums": {
    "orchestrator.md": "abc123",
    "backend.md": "def456",
    ...
  },
  "skill_checksums": {...},
  "command_checksums": {...}
}
```

### Agent Capabilities

**Agents can now:**
1. Recognize their own limitations
2. Suggest improvements to themselves
3. Suggest improvements to other agents
4. Modify themselves (when in agentful repo)
5. Modify other agents (when in agentful repo)
6. Detect when the framework is updated

## Examples

### Example 1: Quick Bugfix

```
User: Fix the login bug

Claude/Orchestrator:
- Work type: BUGFIX
- Workflow: Quick fix → Test → Validate
- Delegating to @frontend...
✓ Fixed in 5 minutes
```

### Example 2: Feature Development

```
User: Build the dashboard

Claude/Orchestrator:
- Work type: FEATURE_DEVELOPMENT
- Workflow: Autonomous loop
- Reading PRODUCT.md...
✓ Implemented dashboard
✓ Added analytics
✓ Added reports
Continuing to next feature...
```

### Example 3: Framework Meta-Development

```
User (in agentful repo): Add a database migration agent

Claude/Orchestrator:
- Context: agentful repository
- Work type: META_WORK → ADD_AGENT
- Creating .claude/agents/database-migrations.md
- Updating orchestrator.md
- Testing...
✓ Agent added
```

### Example 4: Agent Self-Improvement

```
Backend Agent (encountering migration issue):
"I'm struggling with this Prisma migration.
 The current workflow doesn't cover schema drift.
 Logging improvement suggestion..."

[Logs to .agentful/agent-improvements.json]

Orchestrator (on next loop):
- Detected HIGH priority improvement
- Work type: META_WORK → IMPROVE_AGENT
- Improving backend agent...
✓ Backend agent now handles migrations with drift detection
```

## Migration Notes

### For Users

**No breaking changes.** All existing workflows continue to work:

```bash
/agentful-start → Still works (default autonomous mode)
/agentful-status → Still works
/agentful-decide → Still works
/agentful-validate → Still works
```

**New capabilities:**

```bash
# Can now just talk to Claude
"Fix the login bug" → Works
"Add error handling" → Works
"Refactor this code" → Works
"Update dependencies" → Works
```

### For Maintainers

**When working on agentful itself:**

```bash
# Can now use agentful to improve agentful
"Add a deploy command" → Creates command, updates CLI, tests
"Improve the backend agent" → Updates agent.md, tests
"Add an accessibility gate" → Updates validation skill
```

**agentful is now self-improving:**
- Agents recognize limitations
- Agents suggest improvements
- Orchestrator implements improvements
- Framework detects updates

## Next Steps

### Recommended (for you)

1. **Test the new workflows:**
   ```bash
   # In agentful repo
   "Add a /agentful-deploy command"
   → Should create command, update CLI, document

   "Improve the tester agent to handle E2E tests better"
   → Should update tester.md, test improvement
   ```

2. **Create agentful's own PRODUCT.md:**
   - For dogfooding the framework
   - Track agentful's features (commands, agents, skills)
   - Use agentful to build agentful

3. **Test self-improvement:**
   - Have an agent encounter a limitation
   - Verify it logs to agent-improvements.json
   - Verify orchestrator implements improvement

### For Users

1. **Update documentation** to show the new "just talk to Claude" approach
2. **Add examples** of different work types
3. **Highlight meta-work** for framework developers

## Summary

**What changed:**
- ✅ Orchestrator now classifies work type (feature/bugfix/enhance/refactor/meta)
- ✅ Orchestrator detects context (agentful repo vs user project)
- ✅ Agents can self-improve (recognize limitations, suggest improvements)
- ✅ Framework detects updates (checksums of agents/skills)
- ✅ /agentful-start accepts user requests for classification
- ✅ Support for one-off tasks (not just autonomous loop)

**What stayed the same:**
- ✅ Same 4 slash commands
- ✅ Same agent structure
- ✅ Same skill system
- ✅ Same product tracking
- ✅ Same validation gates

**The result:**
- Users just talk to Claude, agentful figures out the rest
- Maintainer can use agentful to improve agentful
- Framework is self-aware and self-improving
- Minimal slash commands, maximum intelligence
